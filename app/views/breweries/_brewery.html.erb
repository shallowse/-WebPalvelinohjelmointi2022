<% cache brewery do %>
  <div id="<%= dom_id brewery %>">
    <h2>
      <%= brewery.name %>
      <% if not brewery.active %>
        <span class="badge bg-secondary">retired</span>
      <% end %>
    </h2>

    <p>
      <em>Established in <%= brewery.year %></em>
    </p>

    <p>
      Beers count: <%= brewery.beers.count %>
    </p>

    <h4>Beers</h4>
    <table class="table table-striped table-hover">
      <thead>
        <tr>
          <th scope="col">Name</th>
          <th scope="col">Style</th>
          <th scope="col">Rating</th>
        </tr>
      </thead>
      <tbody>
        <% brewery.beers.each do |beer| %>
          <tr>
            <td><%= link_to beer.name, beer %></td>
            <td><%= link_to beer.style.name, beer.style%></td>
            <td><%= beer.average_rating %></td>
          </tr>
        <% end %>
      </tbody>
    </table>

    <p>
      <% if brewery.ratings.empty? %>
        Brewery has not yet been rated!
      <% else %>
        Brewery has <%= pluralize(brewery.ratings.count, "rating") %> with
        an average of <%= brewery.average_rating %>
      <% end %>
    </p>
  </div>
<% end %>